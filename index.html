<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¼í•˜ê¸° ì‹«ì–´ì„œ ë§Œë“ ê±°</title>

  <!-- PWA ëŒ€ì‘ -->
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ë†ì‚°ë¬¼ì•±">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 10px;
      margin: 0;
      background: #f9f9f9;
      font-size: 15px;
    }

    h2 {
      font-size: 18px;
      text-align: center;
      margin-bottom: 10px;
    }

    .form-row {
      display: flex;
      gap: 5px;
      margin-bottom: 5px;
    }

    input, select, button {
      padding: 8px;
      font-size: 15px;
      flex: 1;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }

    th {
      background: #eaeaea;
    }

    #totalCount {
      margin-top: 8px;
      font-weight: bold;
      text-align: right;
    }

    .goal-group h3 {
      font-size: 16px;
      margin-top: 20px;
    }

    @media (max-width: 450px) {
      input, select, button {
        font-size: 14px;
        padding: 6px;
      }

      th, td {
        font-size: 12px;
        padding: 5px;
      }
    }
  </style>
</head>
<body>

<h2>ì¼í•˜ê¸° ì‹«ì–´ì„œ ë§Œë“ ê±°</h2>

<!-- ì…ë ¥ í¼ -->
<div class="form-row">
  <input id="hiroshiInput" placeholder="íˆë¡œì‹œ" />
  <input id="nameInput" placeholder="ì´ë¦„" />
</div>
<div class="form-row">
  <input id="countInput" type="number" placeholder="ìˆ˜ëŸ‰" />
</div>
<div class="form-row">
  <button onclick="addRow()">ì¶”ê°€</button>
  <button onclick="clearAll()" style="background-color:#d9534f;">ì „ì²´ ì‚­ì œ</button>
</div>

<!-- í•„í„° -->
<div class="form-row">
  <select id="filterHiroshi" onchange="renderTable()">
    <option value="">íˆë¡œì‹œ ì „ì²´</option>
  </select>
  <select id="filterFruit" onchange="renderTable()">
    <option value="">ê³¼ìˆ˜ ì „ì²´</option>
  </select>
</div>

<!-- ë°ì´í„° í…Œì´ë¸” -->
<table id="dataTable">
  <thead>
    <tr>
      <th>íˆë¡œì‹œ</th>
      <th>ì´ë¦„</th>
      <th>ìˆ˜ëŸ‰</th>
      <th>ì‚­ì œ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- ì´í•© -->
<p id="totalCount">ì´í•©: 0ê°œ</p>

<!-- íˆë¡œì‹œë³„ ëª©í‘œ ìˆ˜ëŸ‰ ì„¤ì • -->
<div class="goal-group">
  <h3>íˆë¡œì‹œ ëª©í‘œ ìˆ˜ëŸ‰ ì„¤ì •</h3>
  <div class="form-row">
    <input id="goalHiroshi" placeholder="íˆë¡œì‹œ (ì˜ˆ: 18)" />
    <input id="goalCount" type="number" placeholder="ëª©í‘œ ìˆ˜ëŸ‰ (ì˜ˆ: 100)" />
  </div>
  <div class="form-row">
    <button onclick="setGoal()">ğŸ¯ ëª©í‘œ ì„¤ì •</button>
  </div>
  <table id="goalTable">
    <thead>
      <tr>
        <th>íˆë¡œì‹œ</th>
        <th>ëª©í‘œ</th>
        <th>í˜„ì¬ ìˆ˜ëŸ‰</th>
        <th>ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  let data = [];
  let goals = {};

  function saveData() {
    localStorage.setItem("hiroshiData", JSON.stringify(data));
    localStorage.setItem("hiroshiGoals", JSON.stringify(goals));
  }

  function loadData() {
    const saved = localStorage.getItem("hiroshiData");
    const savedGoals = localStorage.getItem("hiroshiGoals");
    if (saved) data = JSON.parse(saved);
    if (savedGoals) goals = JSON.parse(savedGoals);
    renderTable();
    updateGoalTable();
  }

  function addRow() {
    const h = document.getElementById("hiroshiInput").value.trim();
    const n = document.getElementById("nameInput").value.trim();
    const f = document.getElementById("fruitInput").value.trim();
    const c = parseInt(document.getElementById("countInput").value);
    if (!h || !n || !f || isNaN(c)) {
      alert("ëª¨ë“  ê°’ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”");
      return;
    }
    data.push({ hiroshi: h, name: n, fruit: f, count: c });
    saveData();
    renderTable();
    updateGoalTable();
    document.getElementById("hiroshiInput").value = "";
    document.getElementById("nameInput").value = "";
    document.getElementById("fruitInput").value = "";
    document.getElementById("countInput").value = "";
  }

  function renderTable() {
    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    const fH = document.getElementById("filterHiroshi").value;
    const fF = document.getElementById("filterFruit").value;

    let total = 0;
    const hSet = new Set(), fSet = new Set();

    data.forEach((d, i) => {
      hSet.add(d.hiroshi);
      fSet.add(d.fruit);
      if ((fH && d.hiroshi !== fH) || (fF && d.fruit !== fF)) return;
      total += d.count;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${d.hiroshi}</td>
        <td>${d.name}</td>
        <td>${d.fruit}</td>
        <td>${d.count}</td>
        <td><button onclick="deleteRow(${i})">ì‚­ì œ</button></td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("totalCount").innerText = `ì´í•©: ${total}ê°œ`;

    const fh = document.getElementById("filterHiroshi");
    const ff = document.getElementById("filterFruit");
    fh.innerHTML = `<option value="">íˆë¡œì‹œ ì „ì²´</option>`;
    ff.innerHTML = `<option value="">ê³¼ìˆ˜ ì „ì²´</option>`;
    [...hSet].sort().forEach(v => fh.innerHTML += `<option value="${v}">${v}</option>`);
    [...fSet].sort().forEach(v => ff.innerHTML += `<option value="${v}">${v}</option>`);
    fh.value = fH;
    ff.value = fF;
  }

  function deleteRow(i) {
    data.splice(i, 1);
    saveData();
    renderTable();
    updateGoalTable();
  }

  function clearAll() {
    if (confirm("ì •ë§ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      data = [];
      saveData();
      renderTable();
      updateGoalTable();
    }
  }

  function setGoal() {
    const h = document.getElementById("goalHiroshi").value.trim();
    const c = parseInt(document.getElementById("goalCount").value);
    if (!h || isNaN(c)) {
      alert("íˆë¡œì‹œì™€ ëª©í‘œ ìˆ˜ëŸ‰ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    goals[h] = c;
    saveData();
    updateGoalTable();
    document.getElementById("goalHiroshi").value = "";
    document.getElementById("goalCount").value = "";
  }

  function updateGoalTable() {
    const tbody = document.querySelector("#goalTable tbody");
    tbody.innerHTML = "";

    Object.keys(goals).forEach(h => {
      const goal = goals[h];
      const current = data
        .filter(d => d.hiroshi === h)
        .reduce((sum, d) => sum + d.count, 0);

      const diff = goal - current;
      const status = diff > 0 ? `âŒ ${diff}ê°œ ë¶€ì¡±` : `âœ… ì¶©ì¡±`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${h}</td>
        <td>${goal}</td>
        <td>${current}</td>
        <td>${status}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  window.onload = loadData;
</script>
</body>
</html>
