<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>과수 관리 앱</title>
  <style>
    body { font-family: 'Arial'; margin: 0; padding: 10px; max-width: 390px; background: #f5f5f5; }
    input, select, button { font-size: 16px; margin: 5px 0; width: 100%; padding: 8px; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; background: white; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #eee; }
    .btn { padding: 8px; margin-top: 5px; cursor: pointer; font-weight: bold; }
    .btn-danger { background: #ff6666; color: white; border: none; }
  </style>
</head>
<body>

  <h2>📋 품종 데이터 입력</h2>
  <input type="text" id="hiroshi" placeholder="히로시 (예: H01)" />
  <input type="text" id="name" placeholder="이름" />
  <input type="text" id="fruit" placeholder="과수 (예: 14내)" />
  <input type="number" id="count" placeholder="개수" />
  <button onclick="addEntry()" class="btn">추가</button>

  <h2>🔍 필터</h2>
  <select id="filterHiroshi" onchange="filterData()"></select>
  <select id="filterFruit" onchange="filterData()"></select>

  <h2>📊 입력 데이터</h2>
  <div id="totalCount">총 갯수: 0</div>
  <table id="dataTable">
    <thead>
      <tr>
        <th>히로시</th>
        <th>이름</th>
        <th>과수</th>
        <th>개수</th>
        <th>삭제</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>🎯 목표표</h2>
  <table id="goalTable">
    <thead>
      <tr>
        <th>히로시</th>
        <th>과수</th>
        <th>목표</th>
        <th>실제</th>
        <th>상태</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let dataList = [];
    let goalList = [
      { hiroshi: "H01", fruit: "14내", goal: 10 },
      { hiroshi: "H02", fruit: "16내", goal: 10 }
    ];

    function addEntry() {
      const hiroshi = document.getElementById("hiroshi").value.trim();
      const name = document.getElementById("name").value.trim();
      const fruit = document.getElementById("fruit").value.trim();
      const count = parseInt(document.getElementById("count").value);

      if (!hiroshi || !name || !fruit || isNaN(count)) {
        alert("모든 칸을 올바르게 입력하세요");
        return;
      }

      dataList.push({ hiroshi, name, fruit, count });
      document.getElementById("hiroshi").value = "";
      document.getElementById("name").value = "";
      document.getElementById("fruit").value = "";
      document.getElementById("count").value = "";

      updateTable();
    }

    function deleteEntry(index) {
      dataList.splice(index, 1);
      updateTable();
    }

    function updateTable() {
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      let total = 0;

      dataList.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.hiroshi}</td>
          <td>${item.name}</td>
          <td>${item.fruit}</td>
          <td>${item.count}</td>
          <td><button class="btn btn-danger" onclick="deleteEntry(${index})">삭제</button></td>
        `;
        tbody.appendChild(row);
        total += item.count;
      });

      document.getElementById("totalCount").textContent = "총 갯수: " + total;
      updateFilters();
      updateGoalTable();
    }

    function updateFilters() {
      const hSet = new Set(dataList.map(d => d.hiroshi));
      const fSet = new Set(dataList.map(d => d.fruit));

      const hSelect = document.getElementById("filterHiroshi");
      const fSelect = document.getElementById("filterFruit");

      hSelect.innerHTML = '<option value="">히로시 전체</option>';
      fSelect.innerHTML = '<option value="">과수 전체</option>';

      hSet.forEach(v => hSelect.innerHTML += `<option value="${v}">${v}</option>`);
      fSet.forEach(v => fSelect.innerHTML += `<option value="${v}">${v}</option>`);
    }

    function filterData() {
      const h = document.getElementById("filterHiroshi").value;
      const f = document.getElementById("filterFruit").value;
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      let total = 0;

      dataList.forEach((item, index) => {
        if ((h && item.hiroshi !== h) || (f && item.fruit !== f)) return;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.hiroshi}</td>
          <td>${item.name}</td>
          <td>${item.fruit}</td>
          <td>${item.count}</td>
          <td><button class="btn btn-danger" onclick="deleteEntry(${index})">삭제</button></td>
        `;
        tbody.appendChild(row);
        total += item.count;
      });

      document.getElementById("totalCount").textContent = "총 갯수: " + total;
    }

    function updateGoalTable() {
      const tbody = document.querySelector("#goalTable tbody");
      tbody.innerHTML = "";

      goalList.forEach(goal => {
        const actual = dataList
          .filter(d => d.hiroshi === goal.hiroshi && d.fruit === goal.fruit)
          .reduce((sum, d) => sum + d.count, 0);
        let status = "부족";
        if (actual === goal.goal) status = "달성";
        else if (actual > goal.goal) status = "초과";

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${goal.hiroshi}</td>
          <td>${goal.fruit}</td>
          <td>${goal.goal}</td>
          <td>${actual}</td>
          <td>${status}</td>
        `;
        tbody.appendChild(row);
      });
    }

    updateTable();
  </script>
</body>
</html>
