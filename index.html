<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>농산물 필터링 앱</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 5px;
      text-align: center;
    }
    input, button {
      margin: 5px 3px;
      padding: 6px;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }
    .summary {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>농산물 입력</h2>
<div class="form-row">
  <input id="hiroshi" placeholder="히로시 (예: H)" />
  <input id="name" placeholder="이름 (예: 김철수)" />
  <input id="fruit" placeholder="과수 (예: 14내)" />
  <input id="count" type="number" placeholder="갯수 (예: 10)" />
  <button onclick="addEntry()">추가</button>
</div>

<h3>필터</h3>
<div class="form-row">
  <input id="filterHiroshi" placeholder="히로시 필터" oninput="updateTable()" />
  <input id="filterFruit" placeholder="과수 필터" oninput="updateTable()" />
</div>

<div class="summary" id="totalCount">총 갯수: 0개</div>

<table id="dataTable">
  <thead>
    <tr>
      <th>히로시</th>
      <th>이름</th>
      <th>과수</th>
      <th>갯수</th>
      <th>삭제</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>히로시별 과수 목표 설정</h2>
<div class="form-row">
  <input id="goalHiroshi" placeholder="히로시" />
  <input id="goalFruit" placeholder="과수" />
  <input id="goalCount" type="number" placeholder="목표 수량" />
  <button onclick="setGoal()">설정</button>
</div>

<table id="goalTable">
  <thead>
    <tr>
      <th>히로시</th>
      <th>과수</th>
      <th>목표</th>
      <th>현재 수량</th>
      <th>상태</th>
      <th>삭제</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  let data = JSON.parse(localStorage.getItem("fruitData") || "[]");
  let goals = JSON.parse(localStorage.getItem("fruitGoals") || "{}");

  function saveData() {
    localStorage.setItem("fruitData", JSON.stringify(data));
    localStorage.setItem("fruitGoals", JSON.stringify(goals));
  }

  function addEntry() {
    const h = document.getElementById("hiroshi").value.trim();
    const n = document.getElementById("name").value.trim();
    const f = document.getElementById("fruit").value.trim();
    const c = parseInt(document.getElementById("count").value);
    if (!h || !n || !f || isNaN(c)) {
      alert("모든 필드를 올바르게 입력해주세요.");
      return;
    }
    data.push({ hiroshi: h, name: n, fruit: f, count: c });
    saveData();
    document.getElementById("hiroshi").value = "";
    document.getElementById("name").value = "";
    document.getElementById("fruit").value = "";
    document.getElementById("count").value = "";
    updateTable();
    updateGoalTable();
  }

  function deleteEntry(index) {
    if (confirm("정말 이 항목을 삭제하시겠습니까?")) {
      data.splice(index, 1);
      saveData();
      updateTable();
      updateGoalTable();
    }
  }

  function updateTable() {
    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    const filterH = document.getElementById("filterHiroshi").value.trim();
    const filterF = document.getElementById("filterFruit").value.trim();
    let total = 0;

    data.forEach((entry, i) => {
      if ((filterH && !entry.hiroshi.includes(filterH)) ||
          (filterF && !entry.fruit.includes(filterF))) return;

      total += entry.count;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${entry.hiroshi}</td>
        <td>${entry.name}</td>
        <td>${entry.fruit}</td>
        <td>${entry.count}</td>
        <td><button onclick="deleteEntry(${i})">삭제</button></td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("totalCount").innerText = `총 갯수: ${total}개`;
  }

  function setGoal() {
    const h = document.getElementById("goalHiroshi").value.trim();
    const f = document.getElementById("goalFruit").value.trim();
    const c = parseInt(document.getElementById("goalCount").value);
    if (!h || !f || isNaN(c)) {
      alert("히로시, 과수, 목표 수량을 모두 입력해주세요.");
      return;
    }
    const key = `${h}|${f}`;
    goals[key] = c;
    saveData();
    document.getElementById("goalHiroshi").value = "";
    document.getElementById("goalFruit").value = "";
    document.getElementById("goalCount").value = "";
    updateGoalTable();
  }

  function deleteGoal(key) {
    if (confirm("정말 이 목표를 삭제하시겠습니까?")) {
      delete goals[key];
      saveData();
      updateGoalTable();
    }
  }

  function updateGoalTable() {
    const tbody = document.querySelector("#goalTable tbody");
    tbody.innerHTML = "";

    Object.keys(goals).forEach(key => {
      const [h, f] = key.split("|");
      const goal = goals[key];
      const current = data
        .filter(d => d.hiroshi === h && d.fruit === f)
        .reduce((sum, d) => sum + d.count, 0);

      const diff = goal - current;
      const status = diff > 0 ? `❌ ${diff}개 부족` : `✅ 충족`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${h}</td>
        <td>${f}</td>
        <td>${goal}</td>
        <td>${current}</td>
        <td>${status}</td>
        <td><button onclick="deleteGoal('${key}')">삭제</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  updateTable();
  updateGoalTable();
</script>

</body>
</html>

