<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¼í•˜ê¸° ì‹«ì–´ì„œ ë§Œë“ ê±°</title>

  <!-- PWA ëŒ€ì‘ -->
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ë†ì‚°ë¬¼ì•±">


  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    input, select, button { margin: 5px; padding: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .filter-group, .goal-group { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>ì¼í•˜ê¸° ì‹«ì–´ì„œ ë§Œë“ ê±°</h2>

  <!-- ì…ë ¥ í¼ -->
  <div>
    <input id="hiroshiInput" placeholder="íˆë¡œì‹œ" />
    <input id="nameInput" placeholder="ì´ë¦„" />
    <input id="fruitInput" placeholder="ê³¼ìˆ˜" />
    <input id="countInput" type="number" placeholder="ìˆ˜ëŸ‰" />
    <button onclick="addRow()">ì¶”ê°€</button>
    <button onclick="clearAll()">ì „ì²´ ì‚­ì œ</button>
  </div>

  <!-- í•„í„° -->
  <div class="filter-group">
    <label>íˆë¡œì‹œ í•„í„°: </label>
    <select id="filterHiroshi" onchange="renderTable()">
      <option value="">ì „ì²´</option>
    </select>
    <label>ê³¼ìˆ˜ í•„í„°: </label>
    <select id="filterFruit" onchange="renderTable()">
      <option value="">ì „ì²´</option>
    </select>
  </div>

  <!-- ë°ì´í„° í…Œì´ë¸” -->
  <table id="dataTable">
    <thead>
      <tr>
        <th>íˆë¡œì‹œ</th>
        <th>ì´ë¦„</th>
        <th>ê³¼ìˆ˜</th>
        <th>ìˆ˜ëŸ‰</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- ì´í•© -->
  <p id="totalCount">ì´í•©: 0ê°œ</p>

  <!-- íˆë¡œì‹œë³„ ëª©í‘œ ìˆ˜ëŸ‰ ì„¤ì • -->
  <div class="goal-group">
    <h3>íˆë¡œì‹œ ëª©í‘œ ìˆ˜ëŸ‰ ì„¤ì •</h3>
    <input id="goalHiroshi" placeholder="íˆë¡œì‹œ (ì˜ˆ: 18)" />
    <input id="goalCount" type="number" placeholder="ëª©í‘œ ìˆ˜ëŸ‰ (ì˜ˆ: 100)" />
    <button onclick="setGoal()">ğŸ¯ ëª©í‘œ ì„¤ì •</button>

    <table id="goalTable">
      <thead>
        <tr>
          <th>íˆë¡œì‹œ</th>
          <th>ëª©í‘œ</th>
          <th>í˜„ì¬ ìˆ˜ëŸ‰</th>
          <th>ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let data = [];
    let goals = {};

    function saveData() {
      localStorage.setItem("hiroshiData", JSON.stringify(data));
      localStorage.setItem("hiroshiGoals", JSON.stringify(goals));
    }

    function loadData() {
      const saved = localStorage.getItem("hiroshiData");
      const savedGoals = localStorage.getItem("hiroshiGoals");
      if (saved) data = JSON.parse(saved);
      if (savedGoals) goals = JSON.parse(savedGoals);
      renderTable();
      updateGoalTable();
    }

    function addRow() {
      const h = document.getElementById("hiroshiInput").value.trim();
      const n = document.getElementById("nameInput").value.trim();
      const f = document.getElementById("fruitInput").value.trim();
      const c = parseInt(document.getElementById("countInput").value);
      if (!h || !n || !f || isNaN(c)) {
        alert("ëª¨ë“  ê°’ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”");
        return;
      }
      data.push({ hiroshi: h, name: n, fruit: f, count: c });
      saveData();
      renderTable();
      updateGoalTable();
      document.getElementById("hiroshiInput").value = "";
      document.getElementById("nameInput").value = "";
      document.getElementById("fruitInput").value = "";
      document.getElementById("countInput").value = "";
    }

    function renderTable() {
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";

      const fH = document.getElementById("filterHiroshi").value;
      const fF = document.getElementById("filterFruit").value;

      let total = 0;
      const hSet = new Set(), fSet = new Set();

      data.forEach((d, i) => {
        hSet.add(d.hiroshi);
        fSet.add(d.fruit);
        if ((fH && d.hiroshi !== fH) || (fF && d.fruit !== fF)) return;
        total += d.count;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.hiroshi}</td>
          <td>${d.name}</td>
          <td>${d.fruit}</td>
          <td>${d.count}</td>
          <td><button onclick="deleteRow(${i})">ì‚­ì œ</button></td>
        `;
        tbody.appendChild(tr);
      });

      // ì´í•©
      document.getElementById("totalCount").innerText = `ì´í•©: ${total}ê°œ`;

      // í•„í„° ì˜µì…˜ ê°±ì‹ 
      const fh = document.getElementById("filterHiroshi");
      const ff = document.getElementById("filterFruit");
      fh.innerHTML = `<option value="">ì „ì²´</option>`;
      ff.innerHTML = `<option value="">ì „ì²´</option>`;
      [...hSet].sort().forEach(v => fh.innerHTML += `<option value="${v}">${v}</option>`);
      [...fSet].sort().forEach(v => ff.innerHTML += `<option value="${v}">${v}</option>`);
      fh.value = fH;
      ff.value = fF;
    }

    function deleteRow(i) {
      data.splice(i, 1);
      saveData();
      renderTable();
      updateGoalTable();
    }

    function clearAll() {
      if (confirm("ì •ë§ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        data = [];
        saveData();
        renderTable();
        updateGoalTable();
      }
    }

    function setGoal() {
      const h = document.getElementById("goalHiroshi").value.trim();
      const c = parseInt(document.getElementById("goalCount").value);
      if (!h || isNaN(c)) {
        alert("íˆë¡œì‹œì™€ ëª©í‘œ ìˆ˜ëŸ‰ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      goals[h] = c;
      saveData();
      updateGoalTable();
      document.getElementById("goalHiroshi").value = "";
      document.getElementById("goalCount").value = "";
    }

    function updateGoalTable() {
      const tbody = document.querySelector("#goalTable tbody");
      tbody.innerHTML = "";

      Object.keys(goals).forEach(h => {
        const goal = goals[h];
        const current = data
          .filter(d => d.hiroshi === h)
          .reduce((sum, d) => sum + d.count, 0);

        const diff = goal - current;
        const status = diff > 0 ? `âŒ ${diff}ê°œ ë¶€ì¡±` : `âœ… ì¶©ì¡±`;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${h}</td>
          <td>${goal}</td>
          <td>${current}</td>
          <td>${status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    window.onload = loadData;
  </script>
</body>
</html>
