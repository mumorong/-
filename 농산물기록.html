<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>ë†ì‚°ë¬¼ í•„í„°ë§</title>

  <!-- PWA ëŒ€ì‘ -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ë†ì‚°ë¬¼ì•±" />
  <link rel="apple-touch-icon" href="/icon-192.png" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 15px;
      margin: 0;
      background: #f9f9f9;
      font-size: 16px;
    }

    h2 {
      font-size: 20px;
      margin-bottom: 10px;
      text-align: center;
    }

    input, select, button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #eaeaea;
    }

    #total {
      margin-top: 10px;
      font-weight: bold;
      text-align: right;
    }

    .danger {
      background-color: #d9534f;
    }

    .danger:hover {
      background-color: #c9302c;
    }

    @media (max-width: 400px) {
      th, td {
        font-size: 13px;
        padding: 6px;
      }
    }
  </style>
</head>
<body>

<h2>ë†ì‚°ë¬¼ ê¸°ë¡ ì•±</h2>

<!-- ì…ë ¥ í¼ -->
<input type="text" id="hiroshi" placeholder="íˆë¡œì‹œ (ì˜ˆ: 18)" />
<input type="text" id="name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)" />
<input type="text" id="type" placeholder="ê³¼ìˆ˜ (ì˜ˆ: 14ë‚´)" />
<input type="number" id="count" placeholder="ê°¯ìˆ˜ (ì˜ˆ: 24)" />
<button onclick="addRow()">â• ì¶”ê°€</button>
<button class="danger" onclick="clearAll()">ğŸ§¹ ì „ì²´ ì‚­ì œ</button>

<!-- í•„í„° -->
<select id="hiroshiFilter" onchange="filterTable()">
  <option value="">íˆë¡œì‹œ í•„í„°</option>
</select>
<select id="typeFilter" onchange="filterTable()">
  <option value="">ê³¼ìˆ˜ í•„í„°</option>
</select>

<!-- í‘œ -->
<table id="dataTable">
  <thead>
    <tr>
      <th>íˆë¡œì‹œ</th>
      <th>ì´ë¦„</th>
      <th>ê³¼ìˆ˜</th>
      <th>ê°¯ìˆ˜</th>
      <th>ì‚­ì œ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- í•©ê³„ -->
<div id="total">ì´ ê°¯ìˆ˜: 0ê°œ</div>

<script>
  let data = [];

  // ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°
  function saveData() {
    localStorage.setItem('farmData', JSON.stringify(data));
  }

  function loadData() {
    const saved = localStorage.getItem('farmData');
    if (saved) {
      data = JSON.parse(saved);
    }
  }

  // í–‰ ì¶”ê°€
  function addRow() {
    const h = document.getElementById("hiroshi").value.trim();
    const n = document.getElementById("name").value.trim();
    const t = document.getElementById("type").value.trim();
    const c = parseInt(document.getElementById("count").value);

    if (!h || !n || !t || isNaN(c)) {
      alert("ëª¨ë“  ê°’ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const row = {
      id: Date.now(),
      hiroshi: h,
      name: n,
      type: t,
      count: c
    };

    data.push(row);
    saveData();
    updateTable();
    updateFilters();

    document.getElementById("hiroshi").value = "";
    document.getElementById("name").value = "";
    document.getElementById("type").value = "";
    document.getElementById("count").value = "";
  }

  // í…Œì´ë¸” ê°±ì‹ 
  function updateTable() {
    // íˆë¡œì‹œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
    data.sort((a, b) => {
      const ah = isNaN(a.hiroshi) ? a.hiroshi : parseInt(a.hiroshi);
      const bh = isNaN(b.hiroshi) ? b.hiroshi : parseInt(b.hiroshi);
      return ah > bh ? 1 : ah < bh ? -1 : 0;
    });

    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    const hFilter = document.getElementById("hiroshiFilter").value;
    const tFilter = document.getElementById("typeFilter").value;

    let total = 0;

    data.forEach(row => {
      if ((hFilter && row.hiroshi !== hFilter)) return;
      if ((tFilter && row.type !== tFilter)) return;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.hiroshi}</td>
        <td>${row.name}</td>
        <td>${row.type}</td>
        <td>${row.count}</td>
        <td><button onclick="deleteRow(${row.id})">ğŸ—‘</button></td>
      `;
      tbody.appendChild(tr);
      total += row.count;
    });

    document.getElementById("total").innerText = `ì´ ê°¯ìˆ˜: ${total}ê°œ`;
  }

  // í•„í„° ì˜µì…˜ ê°±ì‹ 
  function updateFilters() {
    const hSelect = document.getElementById("hiroshiFilter");
    const tSelect = document.getElementById("typeFilter");

    const uniqueH = [...new Set(data.map(d => d.hiroshi))];
    const uniqueT = [...new Set(data.map(d => d.type))];

    hSelect.innerHTML = '<option value="">íˆë¡œì‹œ í•„í„°</option>';
    tSelect.innerHTML = '<option value="">ê³¼ìˆ˜ í•„í„°</option>';

    uniqueH.forEach(h => {
      const opt = document.createElement("option");
      opt.value = h;
      opt.textContent = h;
      hSelect.appendChild(opt);
    });

    uniqueT.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      tSelect.appendChild(opt);
    });
  }

  function filterTable() {
    updateTable();
  }

  // í–‰ ì‚­ì œ
  function deleteRow(id) {
    id = Number(id); // ë¬¸ìì—´ë¡œ ë“¤ì–´ì˜¬ ìˆ˜ ìˆìŒ
    if (confirm("ì •ë§ ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      const index = data.findIndex(item => item.id === id);
      if (index !== -1) {
        data.splice(index, 1);
        saveData();
        updateTable();
        updateFilters();
      }
    }
  }

  // ì „ì²´ ì‚­ì œ
  function clearAll() {
    if (confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
      data = [];
      localStorage.removeItem('farmData');
      updateTable();
      updateFilters();
    }
  }

  // ì´ˆê¸° ë¡œë”©
  window.onload = function () {
    loadData();
    updateTable();
    updateFilters();
  };
</script>

</body>
</html>
